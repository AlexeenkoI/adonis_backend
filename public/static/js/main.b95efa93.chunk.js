(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{290:function(e,t,a){e.exports=a(530)},301:function(e,t,a){},327:function(e,t){},520:function(e,t,a){},522:function(e,t,a){},530:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(9),c=a.n(o),s=a(25),i=a(268),l=a(36),u=a(555),p=a(12),d={name:"",status:"",loggedIn:!1,isFetching:!1,errMsg:"",referer:"/"};var m=a(288),h={isLoaded:!1,isFetching:!1,page:1,limit:10,filters:{address:"",contract_number:"",date_started:"",date_deadline:"",customer:"",customer_id:"",contractor:"",status:"",type_of_work:"",whereString:""},filterData:{types:[],users:[],contractors:[]},data:[],contractLoading:!1,contractIsUpdated:!1,currentContract:{},currentContractFiles:[],filesIsLoading:!1};var f={contractsNotifications:{count:0,data:[]}};var g={currentUserId:"",isLoading:!0,currentUserData:{role:0},count:0,page:1,searchData:{whereString:"",limit:10,offset:0},userIsLoading:!1,data:[]};var E={loading:!1,loaded:!1,count:0,page:1,data:[],searchData:{whereString:"",limit:10,offset:0},currentCustomer:{},updating:!1,lastInsertId:""};var b={settings_loaded:!1,loading:!1,description:{work_types:{name:"\u0412\u0438\u0434\u044b \u0440\u0430\u0431\u043e\u0442",description:"\u0412\u0438\u0434\u044b \u0432\u044b\u043f\u043e\u043b\u043d\u044f\u0435\u043c\u044b\u0445 \u0440\u0430\u0431\u043e\u0442"},user_roles:{name:"\u0420\u043e\u043b\u0438 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435",description:"\u0420\u043e\u043b\u0438 \u0438 \u0443\u0440\u043e\u0432\u043d\u0438 \u0434\u043e\u0441\u0442\u0443\u043f\u0430 \u0432 \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u043e\u043c \u043e\u0444\u0438\u0441\u0435"},status_types:{name:"\u0421\u0442\u0430\u0442\u0443\u0441\u044b \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u0439",description:"\u0421\u0442\u0430\u0442\u0443\u0441\u044b \u0432 \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043c\u043e\u0433\u0443\u0442 \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f"}},data:{work_types:[],user_roles:[],status_types:[]},newData:{},settingsUpdating:!1};var y=Object(l.c)({user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN_ATTEMPT":return Object(p.a)({},e,{isFetching:!0});case"LOGIN_SUCCESS":return console.log("login success"),console.log(t),Object(p.a)({},e,{loggedIn:!0,isFetching:!1,id:t.data.id,name:t.data.name,surename:t.data.surename,status:t.data.status,role:t.data.role_id,userRoles:t.userRoles,referer:t.referer});case"LOGIN_FAIL":return Object(p.a)({},e,{isFetching:!1,errMsg:t.data.errMsg});case"LOGOUT":return Object(p.a)({},e,{loggedIn:!1});case"REINIT_USER":return Object(p.a)({},e,{name:t.data.name,surename:t.data.surename,status:t.data.status,role:t.data.role});default:return e}},contracts:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:h,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_GET_CONTRACTS":return Object(p.a)({},e,{isFetching:!0});case"RECIEVE_CONTRACTS":return Object(p.a)({},e,{isLoaded:!0,isFetching:!1,page:t.page,data:t.data,total:t.total});case"PAGE_CHANGE":return Object(p.a)({},e,{page:t.pageNum});case"SET_LIMIT":return Object(p.a)({},e,{limit:t.limit});case"ERROR_RECIEVE_CONTRACTS":return Object(p.a)({},e,{isLoaded:!1,isFetching:!1});case"SET_FILTERS":var a=e.filters;return a[t.name]=t.filter,Object(p.a)({},e,{isFetching:!1,filters:a});case"APPLY_FILTERS":return Object(p.a)({},e,{isFetching:!0});case"RECIEVE_FILTER_VALUES":return Object(p.a)({},e,{filterData:{types:t.types,users:t.users}});case"START_GET_CONTRACT_DATA":return Object(p.a)({},e,{contractLoading:!0});case"RECIEVE_CONTRACT_DATA":var n=t.data;return Object(p.a)({},e,{contractLoading:!1,currentContract:n});case"CONTRACT_UPDATED":return Object(p.a)({},e,{contractIsUpdated:!0});case"CONTRACT_LEAVED":return Object(p.a)({},e,{contractIsUpdated:!1});case"FILE_UPLOADED":return Object(p.a)({},e,{currentContractFiles:[].concat(Object(m.a)(e),[t.file])});case"START_FILES_LOADING":return Object(p.a)({},e,{filesIsLoading:!0});case"FILE_LIST_LOADED":return Object(p.a)({},e,{filesIsLoading:!1,currentContractFiles:t.data});case"CLEAR_FILE_LIST":return Object(p.a)({},e,{currentContractFiles:[]});default:return e}},notifications:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_CONTRACT_NOTIFICATION":console.log(t);var a=e.contractsNotifications.count+1;return console.log("count"),console.log(a),Object(p.a)({},e,{contractsNotifications:{count:a,data:e.contractsNotifications.data.concat(t.notificationData)}});case"NOTIFICATION_VIEWED":return Object(p.a)({},e,{contractsNotifications:{count:0,data:e.contractsNotifications.data}});default:return e}},userList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_USERS_LIST":return Object(p.a)({},e,{isLoading:!0});case"RECIEVE_USERS_LIST":return Object(p.a)({},e,{isLoading:!1,data:t.data.data.data,count:t.data.total});case"RECIEVE_USER":var a=t.json.data,n=t.json.userRoles;return Object(p.a)({},e,{userIsLoading:!1,currentUserData:a,userRoles:n});case"ADD_CONDITION":var r=e.searchData;return r[t.conType]=t.value,Object(p.a)({},e,{searchData:r});case"SET_PAGE":return Object(p.a)({},e,{page:t.page});case"GET_USER":return Object(p.a)({},e,{userIsLoading:!0});case"CLEAR_CURRENT_USER":return Object(p.a)({},e,{currentUserData:{}});default:return e}},form:u.a,customersList:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:E,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"GET_CUSTOMERS_LIST":return Object(p.a)({},e,{loading:!0});case"RECIEVE_CUSTOMERS_LIST":return Object(p.a)({},e,{loading:!1,loaded:!0,page:t.data.data.page,data:t.data.data.data,count:t.data.data.total});case"RECIEVE_CUSTOMER":return Object(p.a)({},e,{currentCustomer:t.data});case"CREATE_CUSTOMER":return e;case"ADD_CONDITION":var a=e.searchData;return a[t.conType]=t.value,Object(p.a)({},e,{searchData:a});case"SET_PAGE":return Object(p.a)({},e,{page:t.page});case"INSERTING_OR_UPDATING":return Object(p.a)({},e,{updating:!0});case"FINISH_INSERTING":return Object(p.a)({},e,{updating:!1,lastInsertId:t.data});case"CLEAR_LAST_INSERTED":return Object(p.a)({},e,{updating:!1,currentCustomer:{},lastInsertId:""});case"RESET_SEARCH_STRING":return Object(p.a)({},e,{searchString:""});case"ERROR_RECIEVE":return Object(p.a)({},e,{loading:!1});default:return e}},settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CHANGE_VALUE":var a=e.data;return a[t.itemType][t.itemPos][t.itemField]=t.value,Object(p.a)({},e,{newData:a});case"CREATE_VALUE":var n={};return n[t.itemField]=t.value,Object(p.a)({},e,{newData:n});case"CLEAR_ROW":return Object(p.a)({},e,{newData:{}});case"START_UPDATE":return Object(p.a)({},e,{settingsUpdating:!0});case"FINISH_UPDATE":return Object(p.a)({},e,{settingsUpdating:!1});case"START_LOADING":return Object(p.a)({},e,{loading:!0});case"SETTINGS_LOADED":var r=t.data;return Object(p.a)({},e,{loading:!1,settings_loaded:!0,data:r});default:return e}}}),O=a(554),v=(a(301),a(15)),S=a(16),C=a(19),j=a(17),_=a(20),I=a(540),T=a(286),k=a.n(T),w=(a(303),a(556)),R=a(475),L=a(559),A=a(421),D=(a(304),a(270)),F=a.n(D),N=a(14),x=a(543),U=a(550),P=a(18),M=a(65),Y=a(53),G=a(532),z="LOGIN_ATTEMPT",V="LOGIN_SUCCESS",W="LOGIN_FAIL",B="LOGOUT";function H(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"/";return function(r){r({type:z,isFetching:!0});var o={data:{login:e,password:t}};fetch("/api/login",{headers:{Accept:"application/json","Content-Type":"application/json"},method:"POST",body:JSON.stringify(o)}).then(function(e){return e.json()}).then(function(e){!0===e.success?(localStorage.setItem("app_token",e.auth_token),G.a.success(e.message,1.5),r(J(e,n)),a&&(localStorage.setItem("is_remember",!0),localStorage.setItem("currentUser",JSON.stringify(e.data)))):(r($(e)),G.a.error(e.message,2.5))}).then(function(){}).catch(function(e){return r($(e))})}}function J(e,t){return{type:V,data:e.data,userRoles:e.userRoles,isFetching:!1,referer:t}}function $(e){return{type:W,data:e,isFetching:!1}}var K=x.a.Item,Q={labelCol:{span:3},wrapperCol:{span:12,offset:6}},Z=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).handleSubmit=function(e){e.preventDefault(),a.props.form.validateFields(function(e,t){var n=a.props.location.state?a.props.location.state.from:"/",r=n.pathname?n.pathname:"/";e||a.props.loginAction(t.userName,t.password,t.remember,r)})},a.props=e,a.handleSubmit.bind(Object(N.a)(Object(N.a)(a))),a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){console.log("auth redirect");var e=this.props.location.state?this.props.location.state.from:"/",t=e.pathname?e.pathname:"/";console.log("referer"),console.log(t);var a=this.props.autoLogIn;if(document.body.style.backgroundColor="#E0F2F1",localStorage.getItem("is_remember")){var n={};n.data=JSON.parse(localStorage.getItem("currentUser")),a(n,t)}}},{key:"getCookie",value:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return r.a.createElement("div",{className:"auth_block"},r.a.createElement("div",{className:"app_logo fadeInDown animated"}),r.a.createElement("div",{className:"auth_inner fadeIn animated"},r.a.createElement("span",{className:"subheader"},"\u0412\u0445\u043e\u0434 \u0432 \u043e\u0444\u0438\u0441"),r.a.createElement(x.a,{id:"app_login",onSubmit:this.handleSubmit,className:"login-form",layout:"horizontal"},r.a.createElement(K,null,e("userName",{rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043b\u043e\u0433\u0438\u043d"}]})(r.a.createElement(U.a,{prefix:r.a.createElement(P.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"\u041b\u043e\u0433\u0438\u043d"}))),r.a.createElement(K,null,e("password",{rules:[{required:!0,message:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u0432\u0432\u0435\u0434\u0438\u0442\u0435 \u043f\u0430\u0440\u043e\u043b\u044c"}]})(r.a.createElement(U.a,{prefix:r.a.createElement(P.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"\u041f\u0430\u0440\u043e\u043b\u044c"}))),r.a.createElement(K,Q,e("remember",{valuePropName:"checked",initialValue:!1})(r.a.createElement(M.a,null,"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0439 \u0432\u0445\u043e\u0434")),r.a.createElement(Y.a,{type:"primary",htmlType:"submit",className:"login-form-button",loading:this.props.userData.isFetching},"\u0412\u043e\u0439\u0442\u0438")),(this.props.userData.errMsg,""))))}}]),t}(n.Component),X=x.a.create()(Z),q=Object(A.a)(Object(s.b)(function(e){return{userData:e.user}},function(e){return{loginAction:function(t,a,n,r){return e(H(t,a,n,r))},autoLogIn:function(t,a){return e(J(t,a))}}})(X)),ee=a(423);var te=function(){return r.a.createElement("div",{className:"preloadSpinner"},r.a.createElement(ee.a,{size:"large"}))},ae=a(531),ne=a(266),re=a(542),oe=a(549),ce=a(438),se=a(533),ie=a(11),le=a.n(ie),ue="START_GET_CONTRACTS",pe="RECIEVE_CONTRACTS",de="ERROR_RECIEVE_CONTRACTS",me="SET_FILTERS",he="APPLY_FILTERS",fe="RECIEVE_FILTER_VALUES",ge="START_GET_CONTRACT_DATA",Ee="RECIEVE_CONTRACT_DATA";function be(e,t){return function(a){a({type:ue,isLoaded:!1,isFetching:!0});var n={userId:e,data:t};console.log("get contracts...");var r=localStorage.getItem("app_token");fetch("/api/contracts/getall",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"POST",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){!0===e.success&&a(ye(e))}).catch(function(e){a(Oe(e)),G.a.error(e.message)})}}function ye(e){return{type:pe,isFetching:!1,isLoaded:!0,data:e.data.data,total:e.data.total,page:e.data.page}}function Oe(e){return{type:de,msg:e.message}}function ve(e,t){return{type:me,name:e,filter:t}}function Se(e,t,a,n){var r=localStorage.getItem("app_token");return console.log(t),t.filters.date_started=t.filters.date_started&&le()(t.filters.date_started).format("YYYY-MM-DD HH:mm:ss"),t.filters.date_deadline=t.filters.date_deadline&&le()(t.filters.date_deadline).format("YYYY-MM-DD HH:mm:ss"),function(o){o({type:he,isFetching:!0});var c={userId:e,page:a||t.page,limit:n||t.limit,data:t.filters};fetch("/api/contracts/getall",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"POST",body:JSON.stringify(c)}).then(function(e){return e.json()}).then(function(e){!0===e.success&&o(ye(e))}).catch(function(e){o(Oe(e)),G.a.error(e.message)})}}function Ce(e){return{type:"PAGE_CHANGE",pageNum:e}}function je(e){return function(t){var a={userId:e},n=localStorage.getItem("app_token");fetch("/api/contracts/getfilters",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(n)},method:"POST",body:JSON.stringify(a)}).then(function(e){return e.json()}).then(function(e){var a;!0===e.success&&t({type:fe,types:(a=e).filterData.types,users:a.filterData.users})}).catch(function(e){t(Oe(e)),G.a.error(e.message)})}}function _e(e,t){return function(e){e({type:ge});var a=localStorage.getItem("app_token");fetch("/api/contracts/get/"+t,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(a)},method:"GET"}).then(function(e){return e.json()}).then(function(t){var a,n;!0===t.success?(e((n=t.data,{type:Ee,data:n})),e((a=t.data.id,function(e){e({type:"START_FILES_LOADING"});var t=localStorage.getItem("app_token");fetch("/api/files/getfiles/".concat(a),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"GET"}).then(function(e){return e.json()}).then(function(t){if(!0===t.success){var a=t.data;e(Te(a))}else G.a.warning(t.message)}).catch(function(e){G.a.warning(e.message)})}))):G.a.warning(t.message)}).catch(function(e){G.a.error(e.message)})}}function Ie(e,t,a){return function(a){var n={userId:e,data:t},r=localStorage.getItem("app_token");fetch("/api/contracts/update/"+t.id,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"PUT",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){!0===e.success?(G.a.success(e.message),a({type:"CONTRACT_UPDATED"})):G.a.warning(e.message)}).catch(function(e){G.a.warning(e.message)})}}function Te(e){return{type:"FILE_LIST_LOADED",data:e}}var ke="GET_USERS_LIST",we="RECIEVE_USERS_LIST",Re="GET_USER",Le="RECIEVE_USER",Ae="CLEAR_CURRENT_USER",De="ADD_CONDITION",Fe="CLEAR_SEARCH_STRING";function Ne(e,t){return function(a){a({type:ke});var n={userId:e,data:t},r=localStorage.getItem("app_token");fetch("/api/users/getall",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"POST",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){!0===e.success&&a({type:we,data:e})}).catch(function(e){G.a.error(e.message)})}}function xe(e,t){return function(e){e({type:Re});var a=localStorage.getItem("app_token");fetch("/api/users/get/"+t,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(a)},method:"GET"}).then(function(e){return e.json()}).then(function(t){!0===t.success&&e(function(e){return{type:Le,json:e}}(t))}).catch(function(e){G.a.error(e.message)})}}function Ue(e,t){return function(a){var n={userId:e,data:t},r=t.id?t.id:"",o=localStorage.getItem("app_token");fetch("/api/users/update/"+r,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(o)},method:"PUT",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(n){!0===n.success&&(G.a.success(n.messasge),e===t.id?(a(Pe(t)),a(Ne(r))):a(Ne(r)))}).catch(function(e){G.a.error(e.message)})}}function Pe(e){return{type:"REINIT_USER",data:e}}var Me=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return function(a){a({type:"GET_CUSTOMERS_LIST"});var n={userId:e,data:t},r=localStorage.getItem("app_token");fetch("/api/customers/getall",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"POST",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){!0===e.success?a(Ye(e)):(a({type:"ERROR_RECIEVE"}),G.a.error("\u041e\u0448\u0438\u0431\u043a\u0430 ".concat(e.message.toString())))}).catch(function(e){G.a.warning(e.message)})}},Ye=function(e){return{type:"RECIEVE_CUSTOMERS_LIST",data:e}},Ge=function(e,t){return function(e){var a=localStorage.getItem("app_token");fetch("/api/customers/get/"+t,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(a)},method:"GET"}).then(function(e){return e.json()}).then(function(t){!0===t.success&&e(ze(t.data))}).catch(function(e){G.a.warning(e.message)})}},ze=function(e){return{type:"RECIEVE_CUSTOMER",data:e}},Ve=function(e,t,a){return function(n){var r={userId:e,data:t},o=localStorage.getItem("app_token");fetch("/api/customers/update/"+t.id,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(o)},method:"PUT",body:JSON.stringify(r)}).then(function(e){return e.json()}).then(function(t){!0===t.success?(n(Me(e,a)),G.a.success(t.message),n({type:"FINISH_INSERTING",data:t.data.insertId})):G.a.warning(t.message)}).catch(function(e){G.a.warning(e.message)})}},We=function(e,t){return function(a){a({type:"INSERTING_OR_UPDATING"});var n={userId:e,data:t};console.log(n);var r=localStorage.getItem("app_token");fetch("/api/customers/create",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"PUT",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(t){G.a.success(t.message),a(Me(e)),a({type:"FINISH_INSERTING",data:t.insertId})}).catch(function(e){G.a.error(e.message)})}},Be=function(e){return{type:"SETTINGS_LOADED",data:e}},He=function(){return{type:"CLEAR_ROW"}},Je=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(e){e({type:"START_LOADING"});var t=localStorage.getItem("app_token");fetch("/api/settings/getall",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"GET"}).then(function(e){return e.json()}).then(function(t){!0===t.success?e(Be(t.data)):G.a.warn(t.message)}).catch(function(t){G.a.warn("\u041e\u0448\u0438\u0431\u043a\u0430 ".concat(t.message)),e(Be())})}},$e=function(){return{type:"START_UPDATE"}},Ke=function(){return{type:"FINISH_UPDATE"}},Qe=a(548),Ze=a(425),Xe=a(426),qe=a(265),et=a(544),tt=x.a.Item,at=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).handeSubmit=function(e){e.preventDefault(),a.props.applyFilters(a.props.user.id,a.props.applyData)},a.handleInputChange=function(e,t){a.props.setFilters("whereString",e.target.value)},a.handleContractorChange=function(e){a.props.setFilters("contractor",[e])},a.handleStatusChange=function(e){a.props.setFilters("status",e)},a.handleCustomerChange=function(e){e=e>0?e:"",a.props.setFilters("customer_id",e)},a.clearSearchString=function(){a.props.setFilters("whereString","")},a.handleDateFrom=function(e,t){var n=null===e?"":e;a.props.setFilters("date_started",n)},a.handleDateTo=function(e,t){var n=null===e?"":e;a.props.setFilters("date_deadline",n)},a.resetFilters=function(){a.props.resetFilters(a.props.user.id,a.props.applyData),a.props.setPage(1)},a.handeSubmit=a.handeSubmit.bind(Object(N.a)(Object(N.a)(a))),a.handleInputChange=a.handleInputChange.bind(Object(N.a)(Object(N.a)(a))),a.handleContractorChange=a.handleContractorChange.bind(Object(N.a)(Object(N.a)(a))),a.handleStatusChange=a.handleStatusChange.bind(Object(N.a)(Object(N.a)(a))),a.clearSearchString=a.clearSearchString.bind(Object(N.a)(Object(N.a)(a))),a.handleDateFrom=a.handleDateFrom.bind(Object(N.a)(Object(N.a)(a))),a.handleDateTo=a.handleDateTo.bind(Object(N.a)(Object(N.a)(a))),a.resetFilters=a.resetFilters.bind(Object(N.a)(Object(N.a)(a))),a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){}},{key:"render",value:function(){var e=this;return r.a.createElement(Qe.a,{bordered:!1},r.a.createElement(Qe.a.Panel,{header:"\u041f\u043e\u0438\u0441\u043a"},r.a.createElement(x.a,{onSubmit:this.handeSubmit,layout:"vertical"},r.a.createElement(Ze.a,{gutter:12},r.a.createElement(Xe.a,{span:2},r.a.createElement(tt,{label:"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c"},r.a.createElement(qe.a,{showSearch:!0,style:{width:"100%"},defaultValue:this.props.user.id,value:this.props.filters.contractor[0],placeholder:"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c",onChange:this.handleContractorChange,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},r.a.createElement(qe.a.Option,{key:0,value:null},"\u0412\u0441\u0435"),this.props.users.map(function(e){return r.a.createElement(qe.a.Option,{key:e.id,value:e.id},e.name)})))),r.a.createElement(Xe.a,{span:6},r.a.createElement(tt,{label:"\u041f\u043e\u0438\u0441\u043a"},r.a.createElement(U.a,{placeholder:"\u041d\u043e\u043c\u0435\u0440 \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0430, \u0410\u0434\u0440\u0435\u0441, \u0424\u0418\u041e",value:this.props.filters.whereString,onChange:function(t){return e.handleInputChange(t,"searchString")},suffix:this.props.filters.whereString.length>0?r.a.createElement("span",{className:"closePicker"},r.a.createElement(P.a,{type:"close",theme:"outlined",onClick:this.clearSearchString})):""})))),r.a.createElement(Ze.a,{gutter:12},r.a.createElement(Xe.a,{span:2},r.a.createElement(tt,{label:"\u0421\u0442\u0430\u0442\u0443\u0441"},r.a.createElement(qe.a,{showSearch:!0,style:{width:"100%"},placeholder:"\u0421\u0442\u0430\u0442\u0443\u0441",value:this.props.filters.status,onChange:this.handleStatusChange},this.props.filterData?this.props.settings.status_types.map(function(e){return r.a.createElement(qe.a.Option,{key:e.id,value:e.id},e.type)}):""))),r.a.createElement(Xe.a,{span:4},r.a.createElement(tt,{label:"\u041f\u0435\u0440\u0438\u043e\u0434"},r.a.createElement(et.a,{style:{width:"40%"},placeholder:"C",value:""===this.props.filters.date_started?null:le()(this.props.filters.date_started,"YYYY-MM-DD"),format:"YYYY-MM-DD",onChange:this.handleDateFrom}),"-",r.a.createElement(et.a,{style:{width:"40%"},placeholder:"\u041f\u043e",value:""===this.props.filters.date_deadline?null:le()(this.props.filters.date_deadline,"YYYY-MM-DD"),format:"YYYY-MM-DD",onChange:this.handleDateTo}))),r.a.createElement(Xe.a,{span:2},r.a.createElement(tt,{label:"\u0417\u0430\u043a\u0430\u0437\u0447\u0438\u043a"},r.a.createElement(qe.a,{showSearch:!0,style:{width:"100%"},placeholder:"\u0417\u0430\u043a\u0430\u0437\u0447\u0438\u043a",filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},onChange:this.handleCustomerChange,defaultActiveFirstOption:!0},r.a.createElement(qe.a.Option,{key:0,value:0},"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d"),this.props.customers.map(function(e){return r.a.createElement(qe.a.Option,{key:e.id,value:e.id},"".concat(e.name," ").concat(e.firstname," ").concat(e.secondname))})))),r.a.createElement(Xe.a,{span:6},r.a.createElement(tt,{label:"\xa0"},r.a.createElement(Y.a,{type:"primary",htmlType:"submit",loading:this.props.loadingState,icon:"search"},"\u0418\u0441\u043a\u0430\u0442\u044c"),r.a.createElement(Y.a,{type:"danger",onClick:this.resetFilters},"\u0421\u0431\u0440\u043e\u0441\u0438\u0442\u044c")))))))}}]),t}(n.Component),nt=Object(A.a)(Object(s.b)(null,function(e){return{setFilters:function(t,a){return e(ve(t,a))},applyFilters:function(t,a){return e(Se(t,a))},resetFilters:function(t,a){return e(function(e,t){var a=t.filters;for(var n in a)"limit"!==a[n]&&"offset"!==a[n]&&(a[n]="");return a.contractor=[e],a.status=2,a.date_started="",a.date_deadline="",t.limit=10,Se(e,t)}(t,a))},getFilterData:function(t){return e(je(t))},setPage:function(t){return e(Ce(t))}}})(at)),rt=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).handleSearch=function(e,t){return function(){a.props.applyFilter(a.props.user.id,a.props.contracts,e,t[0])}},a.handleReset=function(e){return function(){e(),a.props.resetFilter(a.props.user.id,a.props.contracts.filters)}},a.onPaginationChange=function(e){var t=a.props,n=t.contracts,r=t.setPage;1===e.current||(n.filters.limit,e.current);r(e.current),a.props.applyFilters(a.props.user.id,a.props.contracts,e.current,e.pageSize)},a.onPageSizeChange=function(e,t){(0,a.props.setLimit)(t)},a.onCalendarChange=function(e,t){console.log(e),console.log(t)},a.onRecordClick=function(e){var t=a.props,n=t.user,r=t.getContract;console.log("record clicked: "+e),a.setState(function(e){return{isModalOn:!e.isModalOn}}),r(n.id,e)},a.closeModalClick=function(){a.setState(function(e){return{isModalOn:!1}})},a.onContractFormSubmit=function(e){var t=a.props,n=t.user,r=t.updateContract,o=t.contracts;console.log("form submitted."),console.log(e),r(n.id,e,o.filters),a.closeModalClick()},a.state={searchText:"",isModalOn:!1},a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.user,a=e.users,n=e.getUsers,r=e.customers,o=e.getCustomers,c=e.settings,s=e.loadSettings;a.isLoading&&n(t.id),r.loaded||o(t.id),c.settings_loaded||s(),this.props.contracts.isLoaded||(this.props.setFilters("contractor",[this.props.user.id]),this.props.setFilters("status",2)),this.props.applyFilters(this.props.user.id,this.props.contracts)}},{key:"componentDidUpdate",value:function(e){}},{key:"render",value:function(){var e=this.props,t=(e.user,e.users),a=e.customers,n=e.settings,o=[{title:"\u2116 \u0414\u043e\u0433\u043e\u0432\u043e\u0440\u0430",dataIndex:"id",key:"id"},{title:"\u0414\u0430\u0442\u0430 \u0437\u0430\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f",dataIndex:"date_started",key:"date_started",render:function(e,t){return le()(t.date_started).format("DD.MM.YYYY")}},{title:"\u0424\u0418\u041e \u0417\u0430\u043a\u0430\u0437\u0447\u0438\u043a\u0430",dataIndex:"customer",key:"customer",render:function(e,t){if(a.loaded){var n=a.data.filter(function(e){return e.id===t.customer_id});return"".concat(n[0].firstname," ").concat(n[0].name," ").concat(n[0].secondname)}return r.a.createElement("div",null,r.a.createElement(P.a,{type:"loading"})," \u0417\u0430\u0433\u0440\u0443\u0436\u0430\u044e... ")}},{title:"\u0410\u0434\u0440\u0435\u0441 \u043e\u0431\u044a\u0435\u043a\u0442\u0430",dataIndex:"address",key:"address"},{title:"\u0412\u0438\u0434 \u043a\u0430\u0434\u0430\u0441\u0442\u0440\u043e\u0432\u044b\u0445 \u0440\u0430\u0431\u043e\u0442",dataIndex:"type_of_work",key:"type_of_work",render:function(e,t){if(!n.settings_loaded)return"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u044e...";var a=n.data.work_types.find(function(e){return e.id===t.type_of_work});return a?a.work_type:"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e"}},{title:"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u0438",dataIndex:"name",key:"contractor",render:function(e,t){if(t.users.length>1){var a=r.a.createElement(ae.a,null,t.users.map(function(e){return r.a.createElement(ae.a.Item,{key:e.id},e.name)}));return r.a.createElement(ne.a,{overlay:a},r.a.createElement("a",null,"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u0438",r.a.createElement(P.a,{type:"down"})))}return t.users[0]?t.users[0].name:"\u041d\u0435 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u044b"}},{title:"\u041f\u0440\u0438\u043c\u0435\u0447\u0430\u043d\u0438\u0435",dataIndex:"comment",key:"comment",render:function(e,t){return r.a.createElement(ce.a,{to:"contracts/edit/"+t.id},"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f")}},{title:"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u043e",dataIndex:"date_deadline",key:"date_deadline",render:function(e,t){return t.date_deadline?le()(t.date_deadline).format("DD.MM.YYYY"):"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e"}}];return this.props.contracts.isLoaded?r.a.createElement("div",null,r.a.createElement(nt,{user:this.props.user,filterData:this.props.contracts.filterData,filters:this.props.contracts.filters,applyData:this.props.contracts,loadingState:this.props.contracts.isFetching,isLoaded:this.props.contracts.isLoaded,settings:n.data,users:t.data,customers:a.data}),r.a.createElement(re.a,{rowKey:"id",columns:o,dataSource:this.props.contracts.data,loading:this.props.contracts.isFetching,onChange:this.onPaginationChange,rowClassName:function(e,t){if(e.date_deadline){le()(e.date_deadline).format("DD.MM.YYYY"),le()().format("DD.MM.YYYY");if(e.status<3)return le()().isBefore(e.date_deadline,le()())?"row normal":"row warn";if(e.status>2)return"row finished"}},pagination:{total:this.props.contracts.total,pageSize:this.props.contracts.limit,showSizeChanger:!0,onShowSizeChange:this.onPageSizeChange,current:this.props.contracts.page},locale:{emptyText:"\u0417\u0430\u044f\u0432\u043e\u043a \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"}}),r.a.createElement(oe.a,{footer:!1,visible:this.state.isModalOn,onCancel:this.closeModalClick,title:"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u0437\u0430\u044f\u0432\u043a\u0435"})):r.a.createElement(te,null)}}]),t}(n.Component),ot=Object(A.a)(Object(s.b)(function(e){return{user:e.user,contracts:e.contracts,users:e.userList,settings:e.settings,customers:e.customersList}},function(e){return{getContracts:function(t,a,n,r){return e(be(t,a))},setFilters:function(t,a){return e(ve(t,a))},getContract:function(t,a){return e(_e(0,a))},updateContract:function(t,a,n){return e(Ie(t,a))},applyFilters:function(t,a,n,r){return e(Se(t,a,n,r))},getFilterData:function(t){return e(je(t))},getUsers:function(t){return e(Ne(t))},getCustomers:function(t){return e(Me(t))},setPage:function(t){return e(Ce(t))},setLimit:function(t){return e(function(e){return{type:"SET_LIMIT",limit:e}}(t))},loadSettings:function(){return e(Je())}}})(rt)),ct=a(552),st=a(534),it=a(535),lt=ct.a.Sider,ut=ae.a.SubMenu,pt=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).state={collapsed:!1},a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return r.a.createElement(lt,{trigger:null,collapsible:!0,collapsed:this.props.collapsed},r.a.createElement("div",{className:"logo"},r.a.createElement(ce.a,{to:"/"},r.a.createElement("img",{src:"/images/ukn_logo2.png",alt:"ukn_logo"}))),r.a.createElement(ae.a,{theme:"dark",mode:"inline",selectedKeys:[this.props.history.location.pathname]},r.a.createElement(ut,{key:"/contracts",title:r.a.createElement("span",null,r.a.createElement(P.a,{type:"file-text"}),r.a.createElement("span",null,"\u0417\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f"))},r.a.createElement(ae.a.Item,{key:"/contracts"},r.a.createElement(st.a,{exact:!0,to:"/contracts",activeClassName:"active"},r.a.createElement(P.a,{type:"file-text"}),r.a.createElement("span",null,"\u0412\u0441\u0435 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f"))),r.a.createElement(ae.a.Item,{key:"/contracts/create"},r.a.createElement(st.a,{exact:!0,to:"/contracts/create",activeClassName:"active"},r.a.createElement(P.a,{type:"file-add"}),r.a.createElement("span",null,"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u0435")))),r.a.createElement(ut,{key:"/users",title:r.a.createElement("span",null,r.a.createElement(P.a,{type:"team"}),r.a.createElement("span",null,"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438"))},r.a.createElement(ae.a.Item,{key:"/users/create"},r.a.createElement(st.a,{exact:!0,to:"/users/create",activeClassName:"active"},r.a.createElement(P.a,{type:"user-add"}),r.a.createElement("span",null,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"))),r.a.createElement(ae.a.Item,{key:"/users"},r.a.createElement(st.a,{exact:!0,to:"/users",activeClassName:"active"},r.a.createElement(P.a,{type:"team"}),r.a.createElement("span",null,"\u0412\u0441\u0435 \u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438")))),r.a.createElement(ut,{key:"/customers",title:r.a.createElement("span",null,r.a.createElement(P.a,{type:"solution"}),r.a.createElement("span",null,"\u041a\u043b\u0438\u0435\u043d\u0442\u044b"))},r.a.createElement(ae.a.Item,{key:"/customers/createcustomer"},r.a.createElement(st.a,{to:"/customers/createcustomer",activeClassName:"active"},r.a.createElement(P.a,{type:"usergroup-add"}),r.a.createElement("span",null,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"))),r.a.createElement(ae.a.Item,{key:"/customers"},r.a.createElement(st.a,{to:"/customers",activeClassName:"active"},r.a.createElement(P.a,{type:"solution",theme:"outlined"}),r.a.createElement("span",null,"\u0412\u0441\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u044b")))),r.a.createElement(ut,{key:"sub1",title:r.a.createElement("span",null,r.a.createElement(P.a,{type:"setting"}),r.a.createElement("span",null,"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"))},r.a.createElement(ae.a.Item,null,r.a.createElement(st.a,{to:"/settings",activeClassName:"active"},r.a.createElement(P.a,{type:"setting",theme:"outlined"}),r.a.createElement("span",null,"\u0412\u0441\u0435"))))))}}]),t}(n.Component),dt=Object(it.a)(pt),mt=a(536),ht=a(553),ft=a(537),gt=a(63),Et=a(547),bt=a(541),yt=x.a.Item,Ot={xs:12,sm:24,md:20,lg:12,xl:8},vt={labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:14}}},St=function(e){return function(t){var a=t.input,n=t.meta,o=t.children,c=t.hasFeedback,s=t.label,i=Object(gt.a)(t,["input","meta","children","hasFeedback","label"]),l=n.touched&&n.invalid;return r.a.createElement(yt,Object.assign({},vt,{label:s,validateStatus:l?"error":"success",hasFeedback:c&&l,help:l&&n.error}),r.a.createElement(e,Object.assign({},a,i,{children:o})))}},Ct=St(U.a),jt=St(M.a),_t=St(qe.a),It=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).handleSubmit=function(e){var t=a.props,n=t.user,r=t.updateOne,o=t.createOne;delete e.re_password,delete e.status_text,delete e.is_active,delete e.role_data,!0===e.is_active&&(e.is_active=1),console.log(e),e.id>0?r(n.id,e):o(n.id,e),a.setState({needToRedirect:!0})},a.state={needToRedirect:!1},a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.match,a=e.user,n=e.getOne,r=e.settings,o=e.loadSettings;t&&"undefined"!==typeof t.params.id&&n(a.id,t.params.id),r.settings_loaded&&o()}},{key:"render",value:function(){var e=this.props,t=e.user,a=e.handleSubmit,n=e.pristine,o=e.submitting,c=e.userFetch,s=e.settings,i=e.grid,l=e.initialValues;return this.state.needToRedirect?r.a.createElement(w.a,{to:"/users"}):c?r.a.createElement(te,null):r.a.createElement(Ze.a,{type:"flex",justify:"left"},r.a.createElement(Xe.a,i,r.a.createElement(x.a,{onSubmit:a(this.handleSubmit)},r.a.createElement(Et.a,{type:"hidden",component:"input",name:"id"}),t.id!==l.id&&r.a.createElement(Et.a,{label:"\u0410\u043a\u0442\u0438\u0432\u043d\u0432\u043e\u0441\u0442\u044c",name:"is_active",component:jt,type:"checkbox"}),r.a.createElement(Et.a,{label:"\u0418\u043c\u044f",name:"name",component:Ct,placeholder:"\u0418\u043c\u044f",hasFeedback:!0}),r.a.createElement(Et.a,{label:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",name:"surename",component:Ct,placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f"}),r.a.createElement(Et.a,{label:"\u041b\u043e\u0433\u0438\u043d",name:"login",component:Ct,placeholder:""}),1===this.props.userStatus&&r.a.createElement(Et.a,{label:"\u0421\u0442\u0430\u0442\u0443\u0441",component:_t,name:"role_id"},s.data.user_roles&&s.data.user_roles.map(function(e){return r.a.createElement(qe.a.Option,{value:e.id,key:e.id},e.role_name)})),1===this.props.userStatus&&r.a.createElement(Qe.a,{bordered:!1},r.a.createElement(Qe.a.Panel,{style:{border:0},header:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c"},r.a.createElement(Et.a,{label:"\u041f\u0430\u0440\u043e\u043b\u044c",name:"password",component:Ct,type:"password"}),r.a.createElement(Et.a,{label:"\u041f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u041f\u0430\u0440\u043e\u043b\u044c",name:"re_password",component:Ct,type:"password"}))),r.a.createElement(Y.a,{htmlType:"submit",type:"primary",disabled:n||o},"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"))))}}]),t}(n.Component);var Tt=Object(s.b)(function(e,t){return{user:e.user,userStatus:e.user.role,role:t.userRoles,settings:e.settings,userFetch:e.userList.userIsLoading,initialValues:e.userList.currentUserData,grid:t.gridSettings||Ot}},function(e){return{getOne:function(t,a){return e(xe(0,a))},createOne:function(t,a){return e(function(e,t){return function(a){var n={userId:e,data:t},r=localStorage.getItem("app_token");fetch("/api/users/create/",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"PUT",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(n){!0===n.success&&(G.a.success(n.msg),e===t.id?(a(Pe(t)),a(Ne(e))):a(Ne(e)))}).catch(function(e){G.a.error(e.message)})}}(t,a))},updateOne:function(t,a){return e(Ue(t,a))},loadSettings:function(){return e(Je())}}})(Object(bt.a)({form:"UserForm",validate:function(e){var t={};return e.password!==e.re_password&&(t.re_password="\u041f\u0430\u0440\u043e\u043b\u0438 \u0434\u043e\u043b\u0436\u043d\u044b \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u0442\u044c."),e.name||(t.name="\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f."),!1===/^[\u0430-\u044f\u0451\u0410-\u042f\u0401]+$/.test(e.name)&&(t.name="\u0418\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0438  \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u0438\u0440\u0438\u043b\u043b\u0438\u0446\u0443"),e.login||(t.login="\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u041b\u043e\u0433\u0438\u043d"),!1===/^[a-zA-Z1-9]+$/.test(e.login)&&(t.login="\u0412 \u043b\u043e\u0433\u0438\u043d\u0435 \u043c\u043e\u0433\u0443\u0442 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c\u0441\u044f \u0442\u043e\u043b\u044c\u043a\u043e \u043b\u0430\u0442\u0438\u043d\u0441\u043a\u0438\u0435 \u0431\u0443\u043a\u0432\u044b \u0438 \u0446\u0438\u0444\u0440\u044b"),e.role||(t.role="\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0440\u043e\u043b\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"),t},enableReinitialize:!0,destroyOnUnmount:!0})(It)),kt=U.a.Search,wt=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).toggleDrawer=function(e){a.setState({visible:!0}),a.props.getCurrentUser(a.props.user.id,e)},a.closeDrawer=function(){a.setState({visible:!1})},a.handleSubmit=function(e){a.props.updatedUser(a.props.user.id,e),a.closeDrawer()},a.deleteAction=function(e){a.props.deleteById(a.props.user.id,e)},a.createAction=function(){a.props.clearForm(),a.setState({visible:!0})},a.submitSearch=function(e){var t=a.props,n=t.user,r=t.userList;(0,t.getUserList)(n.id,r.searchData)},a.onPaginationChange=function(e){var t=a.props,n=t.user,r=t.addCond,o=t.userList,c=t.getUserList,s=t.setPage,i=1===e.current?0:o.searchData.limit*(e.current-1);s(e.current),r("offset",i),c(n.id,o.searchData)},a.onPageSizeChange=function(e,t){var n=a.props,r=n.user,o=n.userList,c=n.addCond,s=n.getUserList;c("limit",t),s(r.id,o.searchData)},a.state={is_active:1,visible:!1,needToRedirect:!1},a.toggleDrawer=a.toggleDrawer.bind(Object(N.a)(Object(N.a)(a))),a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.user,a=e.userList;(0,e.getUserList)(t.id,a.searchData)}},{key:"render",value:function(){var e=this,t=this.props,a=t.userList,n=t.addCond,o=[{title:"\u0418\u043c\u044f",key:"name",dataIndex:"name"},{title:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",dataIndex:"surename",key:"surename"},{title:"\u0414\u043e\u043b\u0436\u043d\u043e\u0441\u0442\u044c",dataIndex:"position",key:"position",render:function(e,t){return"\u0412 \u0440\u0430\u0437\u0440\u0430\u0431\u043e\u0442\u043a\u0435"}},{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f",key:"Action",render:function(t,a){var n="\u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b \u0447\u0442\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f "+a.name+"?",o=r.a.createElement(ae.a,null,r.a.createElement(ae.a.Item,{key:"0"},r.a.createElement(ce.a,{to:"/users/edit/"+a.id},"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c")),r.a.createElement(ae.a.Item,{key:"1"},r.a.createElement(mt.a,{onConfirm:function(){return e.deleteAction(a.id)},title:n},r.a.createElement("a",{className:"action-title"},"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"))));return r.a.createElement(ne.a,{overlay:o,trigger:["click"]},r.a.createElement("a",null,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f ",r.a.createElement(P.a,{type:"down"})))}}];return r.a.createElement("div",null,r.a.createElement(Ze.a,null,r.a.createElement(kt,{placeholder:"\u041f\u043e\u0438\u0441\u043a...",value:a.searchData.whereString,onChange:function(e){return n("whereString",e.target.value)},onSearch:this.submitSearch,style:{maxWidth:400},suffix:a.searchData.whereString.length>0?r.a.createElement("span",{key:a.searchData.whereString,className:"closePicker",onClick:function(e){return n("whereString","")}},r.a.createElement(P.a,{type:"close",theme:"outlined"})):"",enterButton:!0})),r.a.createElement(re.a,{rowKey:"id",columns:o,dataSource:this.props.userList.data,loading:this.props.userList.isLoading,onChange:this.onPaginationChange,pagination:{total:a.count,pageSize:a.searchData.limit,showSizeChanger:!0,onShowSizeChange:this.onPageSizeChange,current:a.page},locale:{emptyText:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"}}),r.a.createElement(ht.a,{width:"640",placement:"right",closable:!0,onClose:this.closeDrawer,visible:this.state.visible,destroyOnClose:!0},r.a.createElement("div",null,r.a.createElement("p",null,"\u0418\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f")),r.a.createElement(ft.a,null),r.a.createElement("div",null,this.props.userList.userIsLoading?r.a.createElement(ee.a,null):r.a.createElement(Tt,{onSubmit:this.handleSubmit,initialValues:this.props.userList.currentUserData,userRoles:this.props.user.userRoles}))))}}]),t}(n.Component),Rt=Object(A.a)(Object(s.b)(function(e){return{user:e.user,userList:e.userList}},function(e){return{getUserList:function(t,a){return e(Ne(t,a))},getCurrentUser:function(t,a){return e(xe(0,a))},updatedUser:function(t,a){return e(Ue(t,a))},clearForm:function(){return e({type:Ae})},addCond:function(t,a){return e(function(e,t){return{type:De,conType:e,value:t}}(t,a))},resetSearch:function(){return e({type:Fe})},deleteById:function(t,a){return e(function(e,t){return function(a){if(e!==t){var n={userId:e,deleteId:t},r=localStorage.getItem("app_token");fetch("/api/users/delete/"+t,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"DELETE",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(t){G.a.success(t.message),a(Ne(e))}).catch(function(e){G.a.error(e.message)})}else G.a.warning("\u0412\u044b \u043d\u0435 \u043c\u043e\u0436\u0435\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u0432\u043e\u044e \u0443\u0447\u0435\u0442\u043d\u0443\u044e \u0437\u0430\u043f\u0438\u0441\u044c!")}}(t,a))},setPage:function(t){return e(function(e){return{type:"SET_PAGE",page:e}}(t))}}})(wt)),Lt=a(538),At=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).handleClick=function(){a.setState(function(e){return{isModalOn:!e.isModalOn}}),a.props.loadProfile(a.props.user.id,a.props.user.id)},a.cancelModal=function(){a.setState(function(e){return{isModalOn:!1}})},a.onFormSubmit=function(e){a.cancelModal(),a.props.onSubmit(e)},a.state={isModalOn:!1},a.handleClick=a.handleClick.bind(Object(N.a)(Object(N.a)(a))),a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=r.a.createElement(ae.a,null,r.a.createElement(ae.a.Item,null,r.a.createElement("span",{onClick:this.handleClick},r.a.createElement(P.a,{type:"setting"})," \u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438")),r.a.createElement(ae.a.Item,null,r.a.createElement("span",{onClick:this.props.logOut},r.a.createElement(P.a,{type:"logout"})," \u0412\u044b\u0445\u043e\u0434")));return r.a.createElement("div",null,r.a.createElement(Lt.a,{icon:"user",size:30,shape:"circle"}),r.a.createElement("span",{style:{padding:"10px"}},"".concat(this.props.user.name," ").concat(this.props.user.surename)),r.a.createElement(ne.a,{overlay:e,trigger:["click"]},r.a.createElement("a",{className:"ant-dropdown-link"},"\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f ",r.a.createElement(P.a,{type:"down"}))),r.a.createElement(oe.a,{footer:!1,visible:this.state.isModalOn,onCancel:this.handleClick,title:"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043f\u0440\u043e\u0444\u0438\u043b\u0435"},this.props.isLoading?r.a.createElement(ee.a,null):r.a.createElement(Tt,{onSubmit:this.onFormSubmit,initialValues:this.props.ownProfile,userRoles:this.props.user.userRoles,gridSettings:{xs:24,sm:24,md:24,lg:24,xl:24}})))}}]),t}(n.Component),Dt=a(539),Ft=a(558),Nt=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).handleVisibleChange=function(){a.setState({visible:!a.state.visible}),a.props.viewHandler()},console.log("nofigicator"),console.log(a.props.notifications),a.state={visible:!1},a.handleVisibleChange=a.handleVisibleChange.bind(Object(N.a)(Object(N.a)(a))),a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props.notifications,t=r.a.createElement("div",null,e.data.length>0?e.data.map(function(e){return r.a.createElement(ce.a,{to:"/contracts/edit/".concat(e.id),key:e.id},r.a.createElement("div",null,e.message))}):r.a.createElement("div",null,"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439 \u043d\u0435\u0442"));return r.a.createElement(Dt.a,{content:t,trigger:"click",visible:this.state.visible,onVisibleChange:this.handleVisibleChange,title:e.data.length>0?"\u041d\u043e\u0432\u044b\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f":"\u041d\u043e\u0432\u044b\u0445 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439 \u043d\u0435\u0442"},r.a.createElement(Ft.a,{count:this.props.notifications.count,className:"badge-info"},r.a.createElement(P.a,{type:"message",theme:"outlined",style:{fontSize:22,cursor:"pointer",marginLeft:15}})))}}]),t}(n.Component),xt=x.a.Item,Ut={labelCol:{xl:{span:24},xs:{span:24},sm:{span:24}},wrapperCol:{xl:{span:24},xs:{span:24},sm:{span:24}}},Pt=function(e){return function(t){var a=t.input,n=t.meta,o=t.children,c=t.hasFeedback,s=t.label,i=Object(gt.a)(t,["input","meta","children","hasFeedback","label"]),l=n.touched&&n.invalid;return r.a.createElement(xt,Object.assign({},Ut,{label:s,validateStatus:l?"error":"success",hasFeedback:c&&l,help:l&&n.error}),r.a.createElement(e,Object.assign({},a,i,{children:o})))}},Mt=Pt(U.a),Yt={xs:12,sm:24,md:20,lg:12,xl:8},Gt=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).submitForm=function(e){var t=a.props,n=t.user,r=t.insertOne,o=t.updateOne,c=t.callback;e.id>0?o(n.id,e):r(n.id,e),a.setState({needRedirect:!0}),c&&c()},a.state={needRedirect:!1},a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.match,a=e.user,n=e.getOne;"undefined"!==typeof t&&0!==Object.keys(t.params).length&&n(a.id,t.params.id)}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.clearAll;e.noRedirect||t()}},{key:"render",value:function(){var e=this.props,t=e.handleSubmit,a=e.pristine,n=e.submitting,o=e.fetching,c=e.match,s=e.noRedirect,i=e.grid;return this.state.needRedirect&&!s?r.a.createElement(w.a,{to:"/customers"}):r.a.createElement(Ze.a,null,r.a.createElement(Xe.a,i,r.a.createElement(x.a,{onSubmit:t(this.submitForm)},r.a.createElement(Et.a,{type:"hidden",component:"input",name:"id"}),r.a.createElement(Et.a,{label:"\u0418\u043c\u044f",name:"name",component:Mt,placeholder:"\u0418\u043c\u044f",hasFeedback:!0}),r.a.createElement(Et.a,{label:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",name:"firstname",component:Mt,placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f"}),r.a.createElement(Et.a,{label:"\u041e\u0442\u0447\u0435\u0441\u0442\u0432\u043e",name:"secondname",component:Mt,placeholder:"\u041e\u0442\u0447\u0435\u0441\u0442\u0432\u043e"}),r.a.createElement(Et.a,{label:"\u041f\u043e\u0447\u0442\u0430",type:"email",name:"email",component:Mt,placeholder:"\u041f\u043e\u0447\u0442\u0430"}),r.a.createElement(Et.a,{addonBefore:"+7",label:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",name:"phone",component:Mt,placeholder:"\u0422\u0435\u0435\u043b\u0444\u043e\u043d"}),r.a.createElement(Y.a,{loading:o,htmlType:"submit",type:"primary",disabled:a||n},"undefined"!==typeof c&&0!==Object.keys(c.params).length?"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c"))))}}]),t}(n.Component);var zt=Object(s.b)(function(e,t){return{user:e.user,userStatus:"",noRedirect:t.noRedirect||!1,newForm:e.customersList.currentCustomer.id||0,fetching:e.customersList.updating,contractStatuses:t.statuses,grid:t.gridSettings||Yt,initialValues:e.customersList.currentCustomer,callback:t.onAdd||!1}},function(e){return{insertOne:function(t,a){return e(We(t,a))},updateOne:function(t,a){return e(Ve(t,a))},getOne:function(t,a){return e(Ge(0,a))},clearAll:function(){return e({type:"CLEAR_LAST_INSERTED"})}}})(Object(bt.a)({form:"CustomerForm",validate:function(e){var t={};return e.name||(t.name="\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0438\u043c\u044f."),!1===/^[\u0430-\u044f\u0451\u0410-\u042f\u0401]+$/.test(e.name)&&(t.name="\u0418\u043c\u044f \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e \u0438  \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u0438\u0440\u0438\u043b\u043b\u0438\u0446\u0443."),e.firstname||(t.firstname="\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0443\u043a\u0430\u0437\u0430\u0442\u044c \u0444\u0430\u043c\u0438\u043b\u0438\u044e."),!1===/^[\u0430-\u044f\u0451\u0410-\u042f\u0401]+$/.test(e.firstname)&&(t.firstname="\u0424\u0430\u043c\u0438\u043b\u0438\u044f \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u0430 \u0438  \u0434\u043e\u043b\u0436\u043d\u0430 \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u043a\u0438\u0440\u0438\u043b\u043b\u0438\u0446\u0443."),e.phone||(t.phone="\u0422\u0435\u043b\u0435\u0444\u043e\u043d \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u0435\u043d \u043a \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u044e"),!1===/^[1-90-9]+$/.test(e.phone)&&(t.phone="\u0422\u0435\u043b\u0435\u0444\u043e\u043d \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0438\u0437 \u0446\u0438\u0444\u0440."),t},enableReinitialize:!0,destroyOnUnmount:!0})(Gt)),Vt=U.a.Search,Wt=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).componentWillMount=function(){var e=a.props,t=e.user;(0,e.getCustomers)(t.id)},a.openDetail=function(e){var t=a.props,n=t.user,r=t.getCustomer;a.setState(function(e){return{openModal:!0}}),console.log("customer_id ->"+e),r(n.id,e)},a.closeModal=function(){a.setState(function(e){return{openModal:!1}})},a.clearSearchString=function(){a.props.clearSearch()},a.submitSearch=function(e){var t=a.props,n=t.user,r=t.customers;(0,t.getCustomers)(n.id,r.searchData)},a.handleFormSubmit=function(e){var t=a.props,n=t.user,r=t.customers;(0,t.updateOne)(n.id,e,r.searchData.searchString),a.closeModal()},a.deleteAction=function(e){var t=a.props,n=t.user,r=t.customers;(0,t.deleteOne)(n.id,e,r.searchData.searchString)},a.onPaginationChange=function(e){var t=a.props,n=t.user,r=t.customers,o=t.setCondition,c=t.setPage,s=t.getCustomers,i=1===e.current?0:r.searchData.limit*(e.current-1);c(e.current),o("offset",i),s(n.id,r.searchData)},a.onPageSizeChange=function(e,t){var n=a.props,r=n.user,o=n.customers,c=n.setCondition,s=n.getCustomers;c("limit",t),s(r.id,o.searchData)},a.state={openModal:!1},a.openDetail=a.openDetail.bind(Object(N.a)(Object(N.a)(a))),a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props,t=e.customers,a=e.setCondition,o=[{title:"\u0418\u043c\u044f",dataIndex:"name"},{title:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f",dataIndex:"firstname"},{title:"\u041e\u0442\u0447\u0435\u0441\u0442\u0432\u043e",dataIndex:"secondname"},{title:"\u041f\u043e\u0447\u0442\u0430",dataIndex:"email"},{title:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",dataIndex:"phone"},{title:"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f",render:function(e,t){t.name;var a=r.a.createElement(ae.a,null,r.a.createElement(ae.a.Item,{key:"0"},r.a.createElement(ce.a,{to:"/customers/edit/"+t.id},"\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435")));return r.a.createElement(ne.a,{overlay:a,trigger:["click"]},r.a.createElement("a",null,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f ",r.a.createElement(P.a,{type:"down"})))}}];return r.a.createElement(n.Fragment,null,r.a.createElement(Vt,{placeholder:"\u041f\u043e\u0438\u0441\u043a...",value:t.searchData.whereString,onChange:function(e){return a("whereString",e.target.value)},onSearch:this.submitSearch,style:{maxWidth:400},suffix:t.searchData.whereString.length>0?r.a.createElement("span",{key:t.searchData.whereString,className:"closePicker"},r.a.createElement(P.a,{type:"close",theme:"outlined",onClick:function(e){return a("whereString","")}})):"",enterButton:!0}),r.a.createElement(re.a,{rowKey:"id",columns:o,dataSource:t.data,loading:t.loading,onChange:this.onPaginationChange,pagination:{total:t.count,pageSize:t.searchData.limit,showSizeChanger:!0,onShowSizeChange:this.onPageSizeChange,current:t.page},locale:{emptyText:"\u041a\u043b\u0438\u0435\u043d\u0442\u043e\u0432 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e"}}),r.a.createElement(oe.a,{footer:!1,visible:this.state.openModal,onCancel:this.closeModal,title:"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f \u043e \u043a\u043b\u0438\u0435\u043d\u0442\u0435"},r.a.createElement(zt,{onSubmit:this.handleFormSubmit,customerData:t.currentCustomer})))}}]),t}(n.Component),Bt=Object(s.b)(function(e){return{user:e.user,customers:e.customersList}},function(e){return{getCustomers:function(t,a){return e(Me(t,a))},getCustomer:function(t,a){return e(Ge(0,a))},updateOne:function(t,a,n){return e(Ve(t,a,n))},deleteOne:function(t,a,n){return e(function(e,t,a){return function(n){var r={userId:e,deleteId:t},o=localStorage.getItem("app_token");fetch("/api/customers/delete/"+t,{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(o)},method:"DELETE",body:JSON.stringify(r)}).then(function(e){return e.json()}).then(function(t){G.a.success(t.message),n(Me(e,a))}).catch(function(e){G.a.error(e.message)})}}(t,a,n))},insertOne:function(t,a){return e(We(t,a))},setCondition:function(t,a){return e(function(e,t){return{type:"ADD_CONDITION",conType:e,value:t}}(t,a))},setPage:function(t){return e(function(e){return{type:"SET_PAGE",page:e}}(t))}}})(Wt),Ht=a(551),Jt=Ht.a.Step,$t=Pt(U.a),Kt=Pt(qe.a),Qt=Pt(U.a.TextArea),Zt=x.a.Item,Xt={labelCol:{xl:{span:24},xs:{span:24},sm:{span:24}},wrapperCol:{xl:{span:24},xs:{span:24},sm:{span:24}}},qt=function(e){var t=e.input,a=e.meta,n=(e.children,e.hasFeedback),o=e.label,c=(e.value,e.format,Object(gt.a)(e,["input","meta","children","hasFeedback","label","value","format"])),s=a.touched&&a.invalid;return r.a.createElement(Zt,Object.assign({},Xt,{label:o,validateStatus:s?"error":"success",hasFeedback:n&&s,help:s&&a.error}),r.a.createElement(et.a,Object.assign({},t,c,{value:""===t.value?null:le()(t.value)})))},ea=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).componentWillMount=function(){var e=a.props,t=e.user,n=e.getCustomers,r=e.getUsers;n(t.id),r(t.id)},a.increaseStep=function(){a.setState({step:a.state.step+1})},a.decreaseStep=function(){a.setState({step:a.state.step-1>0?a.state.step-1:0})},a.toggleCreateCustomersForm=function(){a.setState({showCustomersForm:!1})},a.onFormSubmit=function(e){var t=a.props,n=t.user,r=t.createOne;e.date_deadline=le()(e.date_deadline).format("YYYY-MM-DD HH:mm:ss");var o=Object(p.a)({},e);console.log(o),r(n.id,o),a.setState({needToRedirect:!0})},a.openForm=function(){a.setState({showCustomersForm:!0})},a.state={step:0,showCustomersForm:!1,needToRedirect:!1},a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props,t=e.handleSubmit,a=e.pristine,o=e.submitting,c=e.workTypes,s=e.customers,i=e.contractors,l=e.statuses;return this.state.needToRedirect?r.a.createElement(w.a,{to:"/contracts"}):r.a.createElement(n.Fragment,null,r.a.createElement(Ze.a,{type:"flex",justify:"center",gutter:{xs:8,sm:16,md:24,lg:32}},r.a.createElement(Xe.a,{xs:12,sm:24,md:20,lg:24,xl:12},r.a.createElement(Ht.a,{current:this.state.step},r.a.createElement(Jt,{title:"\u0412\u0438\u0434 \u0440\u0430\u0431\u043e\u0442",description:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435, \u0442\u0438\u043f",icon:r.a.createElement(P.a,{type:"exception",theme:"outlined"})}),r.a.createElement(Jt,{title:"\u0414\u0430\u043d\u043d\u044b\u0435 \u043e \u0437\u0430\u044f\u0432\u0438\u0442\u0435\u043b\u0435",description:"",icon:r.a.createElement(P.a,{type:"idcard"})}),r.a.createElement(Jt,{title:"\u0421\u0440\u043e\u043a \u0441\u0434\u0430\u0447\u0438",description:"\u0421\u0440\u043e\u043a \u0441\u0434\u0430\u0447\u0438 \u0438 \u0438\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c",icon:r.a.createElement(P.a,{type:"calendar"})}),r.a.createElement(Jt,{title:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u0440\u0430\u0431\u043e\u0442",description:"",icon:r.a.createElement(P.a,{type:"calculator",theme:"outlined"})})))),r.a.createElement(x.a,{onSubmit:t(this.onFormSubmit)},r.a.createElement(Ze.a,{type:"flex",justify:"center",gutter:{xs:8,sm:16,md:24,lg:32}},r.a.createElement(Xe.a,{xs:12,sm:24,md:20,lg:12,xl:6},r.a.createElement(Et.a,{label:"\u0410\u0434\u0440\u0435\u0441",name:"address",component:Qt,placeholder:"\u0410\u0434\u0440\u0435\u0441"}),r.a.createElement(Et.a,{label:"\u0412\u0438\u0434 \u0440\u0430\u0431\u043e\u0442",component:Kt,name:"type_of_work",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},c.map(function(e){return r.a.createElement(qe.a.Option,{value:e.id,key:e.id},e.work_type)})),r.a.createElement(Et.a,{label:"\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",name:"comment",component:Qt}),this.state.step>1&&r.a.createElement(n.Fragment,null,r.a.createElement(Et.a,{label:"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c",name:"contractor",component:Kt,mode:"multiple",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},i.map(function(e){return r.a.createElement(qe.a.Option,{key:e.id,value:e.id},e.name)})),r.a.createElement(Et.a,{label:"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u043e",name:"date_deadline",component:qt,disabledDate:function(e){return e&&e.valueOf()<Date.now()}}),r.a.createElement(Et.a,{label:"\u0421\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f",name:"status",component:Kt,defaultActiveFirstOption:!0},l.map(function(e){return r.a.createElement(qe.a.Option,{key:e.id,value:e.id},e.type)}))),this.state.step>0&&r.a.createElement(Y.a,{style:{marginRight:"10px"},type:"primary",onClick:this.decreaseStep},r.a.createElement(P.a,{type:"left"})," \u041d\u0430\u0437\u0430\u0434"),this.state.step<3&&r.a.createElement(Y.a,{type:"primary",onClick:this.increaseStep},"\u0414\u0430\u043b\u0435\u0435 ",r.a.createElement(P.a,{type:"right"})),3===this.state.step&&r.a.createElement(Y.a,{style:{display:"block",marginTop:"25px"},htmlType:"submit",type:"primary",disabled:a||o},"\u0421\u043e\u0437\u0434\u0430\u0442\u044c")),r.a.createElement(Xe.a,{xs:12,sm:24,md:20,lg:12,xl:6},this.state.step>0&&r.a.createElement(n.Fragment,null,r.a.createElement(Et.a,{label:"\u041a\u043b\u0438\u0435\u043d\u0442",name:"customer_id",component:Kt,showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},defaultActiveFirstOption:!0,defaultValue:0},r.a.createElement(qe.a.Option,{key:0,value:0},"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d"),s.map(function(e){return r.a.createElement(qe.a.Option,{key:e.id,value:e.id},e.name)})),r.a.createElement(Y.a,{type:"primary",onClick:this.openForm},r.a.createElement(P.a,{type:"user-add",theme:"outlined"}),"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u044f\u0432\u0438\u0442\u0435\u043b\u044f")),this.state.step>2&&r.a.createElement(n.Fragment,null,r.a.createElement(Et.a,{label:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c",name:"price",component:$t,placeholder:"\u041f\u043e\u043b\u043d\u0430\u044f \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c",addonAfter:"\u0440\u0443\u0431"}),r.a.createElement(Et.a,{label:"\u041e\u043f\u043b\u0430\u0447\u0435\u043d\u043e/\u0412\u043d\u0435\u0441\u0435\u043d\u043e",name:"paid",component:$t,placeholder:"\u041e\u043f\u043b\u0430\u0447\u0435\u043d\u043e",addonAfter:"\u0440\u0443\u0431"}))))),r.a.createElement(oe.a,{footer:!1,visible:this.state.showCustomersForm,onCancel:this.toggleCreateCustomersForm,title:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430",destroyOnClose:!0},r.a.createElement(zt,{noRedirect:!0,gridSettings:{xs:24,sm:24,md:24,lg:24,xl:24},onAdd:this.toggleCreateCustomersForm})))}}]),t}(n.Component);var ta=Object(s.b)(function(e,t){return{user:e.user,customers:e.customersList.data,contractors:e.userList.data,st:e.customersList,workTypes:e.settings.data.work_types,statuses:e.settings.data.status_types,initialValues:{customer_id:e.customersList.lastInsertId||0,contractor:[],status:1}}},function(e){return{getCustomers:function(t){return e(Me(t))},insertOne:function(t,a){return e(We(t,a))},getUsers:function(t){return e(Ne(t))},createOne:function(t,a){return e(function(e,t){return function(a){var n={userId:e,data:t},r=localStorage.getItem("app_token");fetch("/api/contracts/create",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"PUT",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){!0===e.success?se.a.open({message:"\u0417\u0430\u044f\u0432\u043a\u0430 \u0441\u043e\u0437\u0434\u0430\u043d\u0430",description:"\u0417\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u043e \u0438 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u043e \u0432 \u0440\u0430\u0431\u043e\u0442\u0443.",duration:3.5}):se.a.open({message:"\u0417\u0430\u044f\u0432\u043a\u0430 \u043d\u0435 \u0441\u043e\u0437\u0434\u0430\u043d\u0430",description:e.msg,duration:3.5})}).catch(function(e){G.a.warning(e.message)})}}(t,a))}}})(Object(bt.a)({form:"CreateContractForm",validate:function(e){var t={};return e.address||(t.address="\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441 \u0440\u0430\u0431\u043e\u0442."),e.customer_id||(t.customer_id="\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430."),e.status||(t.status="\u041f\u0440\u0438\u0441\u0432\u043e\u0439\u0442\u0435 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044e \u0441\u0442\u0430\u0442\u0443\u0441."),e.date_deadline||(t.date_deadline="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0430\u0442\u0443 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442."),e.contractor&&e.contractor!==[]||(t.contractor="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044f."),e.type_of_work||(t.type_of_work="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0438\u043f \u0440\u0430\u0431\u043e\u0442"),e.price||(t.price="\u041f\u043e\u043b\u0435 \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e."),!1===/^[1-90-9]+$/.test(e.price)&&(t.price="\u041f\u043e\u043b\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0447\u0438\u0441\u043b\u0430\u043c\u0438."),!1===/^[1-90-9]+$/.test(e.paid)&&(t.paid="\u041f\u043e\u043b\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0447\u0438\u0441\u043b\u0430\u043c\u0438."),t},enableReinitialize:!0,destroyOnUnmount:!0})(ea)),aa=a(545),na=function(e){function t(){var e,a;Object(v.a)(this,t);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(a=Object(C.a)(this,(e=Object(j.a)(t)).call.apply(e,[this].concat(r)))).download=function(e){fetch(e,{method:"GET"}).then(function(e){return e.blob()}).then(function(e){return URL.createObjectURL(e)}).then(function(e){window.open(e,"_blank"),URL.revokeObjectURL(e)})},a.preview=function(e){console.log("link clicked"),console.log(e),a.download(e.url)},a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){var e=this.props,t=e.actionUrl,a=e.callbackUploader,n=e.callbackRemover,o=e.files,c=e.contractId;return e.loading?r.a.createElement(te,null):r.a.createElement("div",null,r.a.createElement(aa.a,{action:t,multiple:!0,data:{upload_contract:c},headers:{Authorization:"Bearer ".concat(localStorage.getItem("app_token"))},defaultFileList:o,onChange:a,onRemove:n,openFileDialogOnClick:!1},r.a.createElement(Y.a,null,r.a.createElement(P.a,{type:"upload"})," \u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c")))}}]),t}(n.Component),ra={xs:12,sm:24,md:20,lg:12,xl:8},oa=Pt(U.a),ca=Pt(qe.a),sa=Pt(U.a.TextArea),ia=x.a.Item,la={labelCol:{xl:{span:24},xs:{span:24},sm:{span:24}},wrapperCol:{xl:{span:24},xs:{span:24},sm:{span:24}}},ua=function(e){var t=e.input,a=e.meta,n=(e.children,e.hasFeedback),o=e.label,c=(e.value,e.format,Object(gt.a)(e,["input","meta","children","hasFeedback","label","value","format"])),s=a.touched&&a.invalid;return r.a.createElement(ia,Object.assign({},la,{label:o,validateStatus:s?"error":"success",hasFeedback:n&&s,help:s&&a.error}),r.a.createElement(et.a,Object.assign({},t,c,{value:""===t.value?null:le()(t.value),format:"YYYY-MM-DD"})))},pa=function(e){var t=e.input,a=e.meta,n=e.children,o=e.hasFeedback,c=e.label,s=(e.value,Object(gt.a)(e,["input","meta","children","hasFeedback","label","value"])),i=a.touched&&a.invalid;return r.a.createElement(ia,Object.assign({},la,{label:c,validateStatus:i?"error":"success",hasFeedback:o&&i,help:i&&a.error}),r.a.createElement(qe.a,Object.assign({},t,s,{value:t.value?t.value:[],children:n})))},da=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).componentWillMount=function(){var e=a.props,t=e.match,n=e.user,r=e.getOne,o=e.userList,c=e.getUsers;e.loadFileList,e.contractId;console.log(a.props),"undefined"!==typeof t&&r(n.id,t.params.id),o.isLoading||c(n.id)},a.uploadFiles=function(e){var t=e.file.status;"uploading"===t&&(console.log("uploading"),console.log(e)),"error"===t&&(console.log("error uploading"),console.log(e)),"done"===t&&(console.log("success upload"),console.log(e)),"removed"===t&&(console.log("status remove"),console.log(e))},a.handleUpload=function(e){var t=a.props.contractId;"done"===e.file.status&&(console.log(e),e.fileList=e.fileList.map(function(e){return e.response&&(e.url="/api/files/download/".concat(t,"/").concat(e.response.fileName),e.storagePath=e.response.tmpPath),e.hasOwnProperty("response")&&"error"===e.response.status&&(e.status="error",e.response=e.response.error.message),e}),a.props.fileUpload(e.file),G.a.success("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043e"))},a.handleRemove=function(e){var t=a.props,n=(t.files,t.removeFile),r=t.contractId;t.updateFileList;n(r,e.storagePath)},a.removeFiles=function(e){console.log("remove file"),console.log(e)},a.onSubmit=function(e){var t=a.props,n=t.user,r=t.insertOne;delete e.date_started,e.date_deadline=le()(e.date_deadline).format("YYYY-MM-DD HH:mm:ss"),delete e.name,r(n.id,e)},a.cReq=function(e){e.custom_id=2,console.log(e)},a.state={needRedirect:!1},a.onSubmit=a.onSubmit.bind(Object(N.a)(Object(N.a)(a))),a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillUnmount",value:function(){var e=this.props,t=e.leaveContract,a=e.clearFileList;t(),a()}},{key:"render",value:function(){var e=this.props,t=e.handleSubmit,a=e.pristine,n=e.submitting,o=e.user,c=e.files,s=e.contractFetching,i=e.settings,l=e.grid,u=e.userList,p=e.needRedirect,d=e.contractId,m=e.filesLoading,h=o.role>1;return p?r.a.createElement(w.a,{to:"/contracts"}):s?r.a.createElement(te,null):r.a.createElement(Ze.a,null,r.a.createElement(Xe.a,l,r.a.createElement(x.a,{onSubmit:t(this.onSubmit)},r.a.createElement(Et.a,{type:"hidden",component:"input",name:"id"}),r.a.createElement(Et.a,{label:"\u041d\u043e\u043c\u0435\u0440 \u0434\u043e\u0433\u043e\u0432\u043e\u0440\u0430",name:"contract_number",component:oa,disabled:h,placeholder:"\u0424\u0430\u043c\u0438\u043b\u0438\u044f"}),r.a.createElement(Et.a,{label:"\u0410\u0434\u0440\u0435\u0441",name:"address",component:sa,placeholder:"",disabled:h}),r.a.createElement(Et.a,{label:"\u0421\u0442\u0430\u0442\u0443\u0441",component:ca,name:"status"},i.status_types.map(function(e){return r.a.createElement(qe.a.Option,{value:e.id,key:e.id},e.type)})),r.a.createElement(Et.a,{label:"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c",name:"contractor",component:pa,mode:"multiple",showSearch:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0}},r.a.createElement(qe.a.Option,{key:"0",value:0},"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d"),u.data.map(function(e){return r.a.createElement(qe.a.Option,{key:e.id,value:e.id},e.name)})),r.a.createElement(Et.a,{label:"\u0418\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0434\u043e",name:"date_deadline",component:ua,disabledDate:function(e){return e&&e.valueOf()<Date.now()}}),r.a.createElement(Et.a,{label:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438",name:"comment",component:sa,rows:4,placeholder:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0438"}),r.a.createElement(Et.a,{label:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c",name:"price",component:oa,placeholder:"\u041f\u043e\u043b\u043d\u0430\u044f \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c",addonAfter:"\u0440\u0443\u0431"}),r.a.createElement(Et.a,{label:"\u041e\u043f\u043b\u0430\u0447\u0435\u043d\u043e/\u0412\u043d\u0435\u0441\u0435\u043d\u043e",name:"paid",component:oa,placeholder:"\u041e\u043f\u043b\u0430\u0447\u0435\u043d\u043e",addonAfter:"\u0440\u0443\u0431"}),r.a.createElement(Ze.a,{className:"add-info-row"},r.a.createElement(Xe.a,{span:12},r.a.createElement("div",null,"\u0424\u0430\u0439\u043b\u044b :"),r.a.createElement(na,{actionUrl:"/api/files/upload",callbackUploader:this.handleUpload,callbackRemover:this.handleRemove,files:c,contractId:d,loading:m})),r.a.createElement(Xe.a,{span:12},"\u0415\u0449\u0435 \u0447\u0442\u043e-\u0442\u043e")),r.a.createElement(Y.a,{loading:n,htmlType:"submit",type:"primary",disabled:a||n},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"))))}}]),t}(n.Component);var ma=Object(s.b)(function(e,t){return{user:e.user,userStatus:e.user,contractId:e.contracts.currentContract.id,contractFetching:e.contracts.contractLoading,uploadAction:"/api/upload",userList:e.userList,contractStatuses:e.contracts.filterData.types,settings:e.settings.data,grid:t.gridSettings||ra,tv:e.contracts.currentContract,files:e.contracts.currentContractFiles,initialValues:e.contracts.currentContract,needRedirect:e.contracts.contractIsUpdated,filesLoading:e.contracts.filesIsLoading}},function(e){return{getOne:function(t,a){return e(_e(0,a))},insertOne:function(t,a,n){return e(Ie(t,a))},getUsers:function(t){return e(Ne(t))},leaveContract:function(){return e({type:"CONTRACT_LEAVED"})},fileUpload:function(t){return e(function(e){return{type:"FILE_UPLOADED",file:e}}(t))},removeFile:function(t,a){return e(function(e,t){return function(a){var n={filePath:t},r=localStorage.getItem("app_token");fetch("/api/files/remove/".concat(e),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(r)},method:"POST",body:JSON.stringify(n)}).then(function(e){return e.json()}).then(function(e){!0===e.success?G.a.success(e.message):G.a.warning(e.message)}).catch(function(e){G.a.warning(e.message)})}}(t,a))},clearFileList:function(){return e({type:"CLEAR_FILE_LIST"})},updateFileList:function(t){return e(Te(t))}}})(Object(bt.a)({form:"ContractEdit",validate:function(e){var t={};return e.customer_id||(t.customer_id="\u0412\u044b \u0434\u043e\u043b\u0436\u043d\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430."),e.status||(t.status="\u041f\u0440\u0438\u0441\u0432\u043e\u0439\u0442\u0435 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044e \u0441\u0442\u0430\u0442\u0443\u0441."),e.date_deadline||(t.date_deadline="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0434\u0430\u0442\u0443 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f \u0440\u0430\u0431\u043e\u0442."),e.contractor&&e.contractor!==[]||(t.contractor="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0441\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044f."),e.type_of_work||(t.type_of_work="\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0438\u043f \u0440\u0430\u0431\u043e\u0442"),e.price||(t.price="\u041f\u043e\u043b\u0435 \u0441\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e."),!1===/^[1-90-9]+$/.test(e.price)&&(t.price="\u041f\u043e\u043b\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0447\u0438\u0441\u043b\u0430\u043c\u0438."),!1===/^[1-90-9]+$/.test(e.paid)&&(t.paid="\u041f\u043e\u043b\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e \u0447\u0438\u0441\u043b\u0430\u043c\u0438."),t},enableReinitialize:!0,destroyOnUnmount:!0})(da)),ha=x.a.Item,fa={labelCol:{xl:{span:24},xs:{span:24},sm:{span:24}},wrapperCol:{xl:{span:24},xs:{span:24},sm:{span:24}}},ga=function(e){function t(){return Object(v.a)(this,t),Object(C.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.match;console.log(e.params.type)}},{key:"componentWillUnmount",value:function(){(0,this.props.clearRow)()}},{key:"render",value:function(){var e=this.props,t=e.user,a=e.settings,o=e.match,c=e.setFieldValue,s=e.createRow,i=e.performInsert,l=e.performUpdate,u=a.data[o.params.type];return console.log(a.newData),r.a.createElement(n.Fragment,null,r.a.createElement("div",null,a.description[o.params.type].name),r.a.createElement(Xe.a,{span:4},u.map(function(e,n){return Object.keys(e).map(function(e,s){return"id"===e?r.a.createElement(U.a,{type:"hidden",key:s,name:e,value:u[n][e]}):r.a.createElement(ha,Object.assign({},fa,{key:s}),r.a.createElement(U.a,{style:{width:"50%",marginRight:"10px"},type:"text",name:e,value:u[n][e],onChange:function(t){return c(o.params.type,n,e,t.target.value)}}),r.a.createElement(Y.a,{onClick:function(){return l(t.id,o.params.type,u[n])},loading:a.settingsUpdating,icon:"edit"},"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"))})}),r.a.createElement(ha,fa,Object.keys(u[0]).map(function(e,t){return"id"!==e&&r.a.createElement(U.a,{type:"text",key:t,style:{width:"50%",marginRight:"10px"},name:e,value:a.newData[e],onChange:function(t){return s(o.params.type,e,t.target.value)}})}),r.a.createElement(Y.a,{type:"primary",disabled:0===Object.keys(a.newData).length,onClick:function(){return i(t.id,o.params.type,a.newData)},loading:a.settingsUpdating,icon:"check"},"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"))))}}]),t}(n.Component),Ea=Object(s.b)(function(e){return{user:e.user,settings:e.settings}},function(e){return{setFieldValue:function(t,a,n,r){return e(function(e,t,a,n){return{type:"CHANGE_VALUE",itemPos:t,itemType:e,itemField:a,value:n}}(t,a,n,r))},createRow:function(t,a,n){return e(function(e,t,a){return""===a?He():{type:"CREATE_VALUE",itemType:e,itemField:t,value:a}}(t,a,n))},clearRow:function(){return e(He())},performInsert:function(t,a,n){return e(function(e,t,a){return function(n){n($e());var r={userId:e,data:a};console.log(r);var o=localStorage.getItem("app_token");fetch("/api/".concat(t,"/create"),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(o)},method:"PUT",body:JSON.stringify(r)}).then(function(e){return e.json()}).then(function(e){!0===e.success?(G.a.success(e.message),n(Je()),n(He())):G.a.warn(e.message),n(Ke())}).catch(function(e){G.a.warn("\u041e\u0448\u0438\u0431\u043a\u0430 ".concat(e.message)),n(Ke())})}}(t,a,n))},performUpdate:function(t,a,n){return e(function(e,t,a){return function(n){var r=a.id;delete a.id,n($e());var o={userId:e,data:a},c=localStorage.getItem("app_token");fetch("/api/".concat(t,"/update/").concat(r),{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(c)},method:"PUT",body:JSON.stringify(o)}).then(function(e){return e.json()}).then(function(e){!0===e.success?G.a.success(e.message):G.a.warn(e.message),n(Ke())}).catch(function(e){G.a.warn("\u041e\u0448\u0438\u0431\u043a\u0430 ".concat(e.message)),n(Ke())})}}(t,a,n))}}})(ga);function ba(){return r.a.createElement("div",null,"\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430.",r.a.createElement(ce.a,{to:"/"},"\u041d\u0430 \u0433\u043b\u0430\u0432\u043d\u0443\u044e"))}var ya=function(e){function t(){return Object(v.a)(this,t),Object(C.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return r.a.createElement("div",null,"\u041a\u043e\u043c\u043f\u043e\u043d\u0435\u043d\u0442 \u0433\u043b\u0430\u0432\u043d\u043e\u0439 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b.")}}]),t}(n.Component),Oa=a(557),va={"/users":"\u0421\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0438","/users/edit":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430","/users/create":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043d\u043e\u0432\u043e\u0433\u043e \u0441\u043e\u0442\u0440\u0443\u0434\u043d\u0438\u043a\u0430","/customers":"\u041a\u043b\u0438\u0435\u043d\u0442\u044b","/customers/edit":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430","/customers/createcustomer":"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0430","/contracts":"\u0417\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f","/contracts/edit":"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443","/contracts/create":"\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443","/settings":"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438","/settings/work_types":"\u0412\u0438\u0434\u044b \u0440\u0430\u0431\u043e\u0442","/settings/user_roles":"\u0412\u0438\u0434\u044b \u0440\u043e\u043b\u0435\u0439","/settings/status_types":"\u0421\u0442\u0430\u0442\u0443\u0441\u044b \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u0439"},Sa=Object(it.a)(function(e){var t=e.location.pathname.split("/").filter(function(e){return e}),a=t.map(function(e,a){var n="";if(a<2)return n="/".concat(t.slice(0,a+1).join("/")),r.a.createElement(Oa.a.Item,{key:n},r.a.createElement(ce.a,{to:n},va[n]))}),n=[r.a.createElement(Oa.a.Item,{key:"/"},r.a.createElement(ce.a,{to:"/"},"\u0413\u043b\u0430\u0432\u043d\u0430\u044f"))].concat(a);return r.a.createElement(Oa.a,{separator:r.a.createElement(P.a,{type:"right",theme:"outlined"})},n)}),Ca=a(546),ja=function(e){function t(){return Object(v.a)(this,t),Object(C.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){(0,this.props.loadSettings)()}},{key:"render",value:function(){var e=this.props.settings,t=Ca.a.Meta,a=Object.keys(e.data);return r.a.createElement(Ze.a,{type:"flex",justify:"start",style:{flexWrap:"wrap"}},e.loading?r.a.createElement(te,null):a.map(function(n,o){return r.a.createElement(Ca.a,{style:{margin:"15px",width:"300px"},className:"settings-card",key:o,actions:[r.a.createElement(ce.a,{to:"/settings/"+a[o]},r.a.createElement(P.a,{type:"setting"}))],hoverable:!0},r.a.createElement(t,{style:{minHeight:"110px"},title:e.description[n].name,description:e.description[n].description}))}))}}]),t}(n.Component),_a=Object(A.a)(Object(s.b)(function(e){return{user:e.user,settings:e.settings}},function(e){return{loadSettings:function(t){return e(Je(t))}}})(ja)),Ia="GET_CONTRACT_NOTIFICATION",Ta="NOTIFICATION_VIEWED";a(519);var ka=ct.a.Header,wa=ct.a.Content,Ra=F()("ws://127.0.0.1:3333"),La=function(e){function t(e){var a;return Object(v.a)(this,t),(a=Object(C.a)(this,Object(j.a)(t).call(this,e))).tryToLogin=function(e){a.setState({isLogged:!0})},a.toggle=function(){a.setState({collapsed:!a.state.collapsed})},a.handleProfileSubmit=function(e){a.props.changeProfileData(a.props.currentUser.id,e)},a.state={isLogged:!1,collapsed:!1},a}return Object(_.a)(t,e),Object(S.a)(t,[{key:"componentWillMount",value:function(){var e=this;if(this.props.currentUser){var t=localStorage.getItem("app_token");Ra.withJwtToken(t).connect(),Ra.subscribe("contractsRoom").on("newContractData",function(t){console.log(t),e.props.recieveContractNotification(t),se.a.open({message:"\u041d\u043e\u0432\u043e\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435",description:t[0].message,duration:3})})}}},{key:"componentWillUnmount",value:function(){console.log("component unmounted"),Ra.emit("close")}},{key:"render",value:function(){return!1===this.props.currentUser.loggedIn?r.a.createElement(n.Fragment,null,"/login"!==this.props.location.pathname&&r.a.createElement(w.a,{to:{pathname:"/login",state:{from:this.props.location}}}),r.a.createElement(R.a,{path:"/login",component:q})):r.a.createElement(ct.a,{className:"mainContainer"},r.a.createElement(dt,{collapsed:this.state.collapsed}),r.a.createElement(ct.a,null,r.a.createElement(ka,{className:"header",style:{background:"#fff",padding:0}},r.a.createElement(Ze.a,{type:"flex",justify:"space-between",align:"middle"},r.a.createElement(Xe.a,null,r.a.createElement("div",null,r.a.createElement("span",{className:"badge-info ant-badge"},r.a.createElement(P.a,{className:"trigger",type:this.state.collapsed?"menu-unfold":"menu-fold",onClick:this.toggle,style:{fontSize:22,marginLeft:15,cursor:"pointer"}})),r.a.createElement(Nt,{notifications:this.props.notifications.contractsNotifications,viewHandler:this.props.viewHandler}))),r.a.createElement(Xe.a,{style:{marginRight:"15px"}},r.a.createElement(At,{user:this.props.currentUser,logOut:this.props.logout,loadProfile:this.props.getProfileData,onSubmit:this.handleProfileSubmit,ownProfile:this.props.userProfile,isLoading:this.props.isLoadingProfile})))),r.a.createElement(wa,{style:{margin:"24px 16px 16px 24px",padding:24,background:"#fff"}},r.a.createElement("div",{style:{padding:"15px"}},r.a.createElement(Sa,null)),r.a.createElement(L.a,null,r.a.createElement(w.a,{from:"/login",to:this.props.currentUser.referer}),r.a.createElement(w.a,{exact:!0,from:"/",to:"/contracts"}),r.a.createElement(R.a,{exact:!0,path:"/",component:ya}),r.a.createElement(R.a,{exact:!0,path:"/contracts",component:ot}),r.a.createElement(R.a,{path:"/contracts/create",component:ta}),r.a.createElement(R.a,{exact:!0,path:"/contracts/edit/:id",component:ma}),r.a.createElement(R.a,{exact:!0,path:"/users",component:Rt}),r.a.createElement(R.a,{exact:!0,path:"/users/create",component:Tt}),r.a.createElement(R.a,{exact:!0,path:"/users/edit/:id",component:Tt}),r.a.createElement(R.a,{exact:!0,path:"/customers",component:Bt}),r.a.createElement(R.a,{exact:!0,path:"/customers/edit/:id",component:zt}),r.a.createElement(R.a,{exact:!0,path:"/customers/createcustomer",component:zt}),r.a.createElement(R.a,{exact:!0,path:"/settings",component:_a}),r.a.createElement(R.a,{exact:!0,path:"/settings/:type",component:Ea}),r.a.createElement(R.a,{component:ba})))))}}]),t}(n.Component),Aa=Object(A.a)(Object(s.b)(function(e){return{currentUser:e.user,contracts:e.contracts,notifications:e.notifications,isLoadingProfile:e.userList.userIsLoading,userProfile:e.userList.currentUserData,settings:e.settings}},function(e){return{logout:function(){return e(function(e){var t=localStorage.getItem("app_token");fetch("/api/logout",{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer ".concat(t)},method:"POST"}).then(function(e){return e.json()}).then(function(t){console.log("logout data"),console.log(t),t.success&&(G.a.success(t.message,1.5),localStorage.removeItem("app_token"),localStorage.removeItem("is_remember"),localStorage.removeItem("currentUser"),e({type:B}))}).catch(function(e){G.a.error(e.message,2)})})},recieveContractNotification:function(t){return e({type:Ia,notificationData:t})},getProfileData:function(t,a){return e(xe(0,a))},changeProfileData:function(t,a){return e(Ue(t,a))},viewHandler:function(){return e({type:Ta})}}})(La)),Da=(a(520),a(522),function(e){function t(){return Object(v.a)(this,t),Object(C.a)(this,Object(j.a)(t).apply(this,arguments))}return Object(_.a)(t,e),Object(S.a)(t,[{key:"render",value:function(){return r.a.createElement(I.a,{locale:k.a},r.a.createElement(Aa,null))}}]),t}(n.Component)),Fa=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Na(e){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var t=e.installing;t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}var xa=a(287),Ua=a.n(xa)()(),Pa=Object(l.d)(y,Object(l.a)(i.a));c.a.render(r.a.createElement(s.a,{store:Pa,history:Ua},r.a.createElement(O.a,null,r.a.createElement(Da,null))),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("","/service-worker.js");Fa?(function(e){fetch(e).then(function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Na(e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):Na(e)})}}()}},[[290,2,1]]]);
//# sourceMappingURL=main.b95efa93.chunk.js.map